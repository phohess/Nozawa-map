<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>野澤滑雪助手 Pro V4</title>
    <script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
    <style>
        :root { 
            --primary: #2ecc71; --info: #3498db; --danger: #e74c3c; 
            --bg: #000000; --panel: rgba(25, 25, 25, 0.9); 
        }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; touch-action: none; }
        body { margin: 0; background: var(--bg); color: white; height: 100vh; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, sans-serif; }

        /* 地圖顯示區域 */
        #viewport { width: 100vw; height: 100vh; cursor: grab; background: #1a1a1a; position: relative; }
        #map-element { width: 100%; position: relative; transform-origin: 0 0; }
        #ski-map { width: 100%; display: block; filter: contrast(1.05) brightness(1.05); }

        /* 透明點擊熱區 (僅感應，不顯示) */
        .zone { position: absolute; z-index: 5; }

        /* 頂部狀態列 */
        .top-bar {
            position: fixed; top: 0; left: 0; right: 0; padding: 50px 20px 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
            z-index: 90; display: flex; justify-content: space-between; pointer-events: none;
        }

        /* 難度對照表 */
        .difficulty-legend {
            position: fixed; top: 100px; right: 10px; z-index: 90;
            display: flex; flex-direction: column; gap: 6px;
        }
        .diff-item { 
            display: flex; align-items: center; gap: 6px; 
            background: rgba(0,0,0,0.7); padding: 4px 10px; border-radius: 12px; font-size: 11px;
        }
        .dot { width: 8px; height: 8px; border-radius: 50%; }

        /* 底部操作面板 */
        .bottom-panel {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--panel); backdrop-filter: blur(20px);
            padding: 15px 12px 35px; border-top: 1px solid #333;
            display: flex; flex-direction: column; gap: 15px; z-index: 100;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }

        /* 分區快速跳轉 (橫向滾動) */
        .nav-scroll { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 5px; -webkit-overflow-scrolling: touch; }
        .nav-btn { 
            flex: 0 0 auto; background: #333; padding: 10px 18px; 
            border-radius: 20px; font-size: 13px; border: 1px solid #444; color: #ddd;
        }
        .nav-btn:active { background: #555; }

        /* 功能按鈕組 */
        .action-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .btn {
            background: #444; color: white; border: none; padding: 14px 5px;
            border-radius: 14px; font-size: 11px; font-weight: bold;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .btn-home { background: var(--primary); color: #000; }
        .btn-info { background: var(--info); }
        .btn-sos { background: var(--danger); }
    </style>
</head>
<body>

<div class="top-bar">
    <div style="font-weight: 900; letter-spacing: 1px;">NOZAWA ONSEN 2026</div>
    <div style="font-size: 11px; opacity: 0.6;">雙指縮放 / 自由拖曳</div>
</div>

<div class="difficulty-legend">
    <div class="diff-item"><div class="dot" style="background:#27ae60"></div> 初級</div>
    <div class="diff-item"><div class="dot" style="background:#e67e22"></div> 中級</div>
    <div class="diff-item"><div class="dot" style="background:#c0392b"></div> 高級</div>
</div>

<div id="viewport">
    <div id="map-element">
        <img src="nozawa_map.jpg" id="ski-map">
        
        <div class="zone" style="top:5%; left:45%; width:25%; height:20%;" onclick="focusOn(3.5, 55, 15)"></div> <div class="zone" style="top:25%; left:15%; width:30%; height:25%;" onclick="focusOn(2.8, 30, 35)"></div> <div class="zone" style="top:50%; left:5%; width:30%; height:30%;" onclick="focusOn(2.5, 20, 65)"></div> <div class="zone" style="top:45%; left:35%; width:35%; height:35%;" onclick="focusOn(2.5, 50, 60)"></div> <div class="zone" style="top:55%; left:65%; width:35%; height:40%;" onclick="focusOn(2.2, 80, 75)"></div> </div>
</div>

<div class="bottom-panel">
    <div class="nav-scroll">
        <div class="nav-btn" onclick="focusOn(3.5, 55, 15)">山頂 Yamabiko</div>
        <div class="nav-btn" onclick="focusOn(2.8, 30, 35)">樂園 Paradise</div>
        <div class="nav-btn" onclick="focusOn(2.5, 20, 65)">日影 Hikage</div>
        <div class="nav-btn" onclick="focusOn(2.5, 50, 60)">長坂 Nagasaka</div>
        <div class="nav-btn" onclick="focusOn(2.2, 80, 75)">柄澤 Karasawa</div>
    </div>

    <div class="action-grid">
        <button class="btn btn-home" onclick="resetMap()">全身圖</button>
        <button class="btn btn-info" onclick="focusOn(2.2, 92, 50)">資訊清單</button>
        <button class="btn" onclick="window.open('https://nozawaski.com/report/')">纜車狀態</button>
        <button class="btn btn-sos" onclick="window.location.href='tel:0269853456'">救援 SOS</button>
    </div>
</div>

<script>
    const elem = document.getElementById('map-element');
    
    // 初始化 Panzoom：允許平移與雙指縮放
    const pz = Panzoom(elem, {
        maxScale: 6,
        minScale: 1,
        contain: 'outside',
        animate: true,
        duration: 400,
        easing: 'cubic-bezier(0.2, 0, 0.2, 1)'
    });

    // 啟用滾輪/觸控縮放
    elem.parentElement.addEventListener('wheel', pz.zoomWithWheel);

    /**
     * 智能對焦函數
     * @param {number} s - 縮放倍率
     * @param {number} xPercent - 圖片中心 X 座標百分比 (0-100)
     * @param {number} yPercent - 圖片中心 Y 座標百分比 (0-100)
     */
    function focusOn(s, xPercent, yPercent) {
        // 輕微震動回饋 (Android 支援)
        if (navigator.vibrate) navigator.vibrate(40);
        
        pz.zoom(s);
        
        setTimeout(() => {
            const rect = elem.getBoundingClientRect();
            // 計算讓該百分比座標移動到螢幕中心的位移量
            const targetX = -(rect.width * (xPercent / 100) - window.innerWidth / 2);
            const targetY = -(rect.height * (yPercent / 100) - window.innerHeight / 2);
            pz.pan(targetX, targetY);
        }, 50);
    }

    function resetMap() {
        if (navigator.vibrate) navigator.vibrate(20);
        pz.reset();
    }

    // 雙擊畫面重置為全身圖
    document.getElementById('viewport').addEventListener('dblclick', (e) => {
        e.preventDefault();
        resetMap();
    });

    // 修正 iOS 10+ 禁止縮放的行為，確保 App 體驗
    document.addEventListener('gesturestart', (e) => {
        e.preventDefault();
    });
</script>

</body>
</html>


